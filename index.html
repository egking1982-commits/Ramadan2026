<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø±Ù…Ø¶Ø§Ù† Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ 1447 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a2a6c; --gold: #f2a900; --silver: #c0c0c0; --bronze: #cd7f32; --dark: #0f172a; --card: #1e293b; --red: #ef4444; --success: #22c55e; --blue: #3b82f6;
        }
        body {
            font-family: 'Cairo', sans-serif; background: radial-gradient(circle at top, #1e293b, #0f172a);
            color: #f8fafc; margin: 0; min-height: 100vh; text-align: center; overflow-x: hidden;
        }
        .page { display: none; padding: 20px; max-width: 500px; margin: auto; animation: fadeIn 0.5s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card {
            background: var(--card); padding: 20px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05);
        }
        .dhikr-bar {
            background: rgba(242, 169, 0, 0.1); border: 1px dashed var(--gold);
            padding: 10px; border-radius: 15px; margin-bottom: 15px;
            font-weight: 600; color: var(--gold); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

        .prayer-bar {
            background: linear-gradient(90deg, rgba(242, 169, 0, 0.15), transparent);
            border-right: 4px solid var(--gold); padding: 12px; border-radius: 10px; margin-bottom: 15px; font-weight: bold;
        }

        #quiz-timer {
            font-size: 1.8rem; color: var(--red); font-weight: 800; margin-bottom: 10px; display: none;
        }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: var(--card); width: 85%; max-width: 400px; padding: 25px; border-radius: 25px;
            border: 2px solid var(--gold); text-align: center;
        }
        .exp-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px; margin: 15px 0; font-size: 0.95rem; line-height: 1.6; color: #cbd5e1; }

        button {
            width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px; border: none;
            font-weight: 700; cursor: pointer; font-family: 'Cairo';
            background: linear-gradient(135deg, var(--gold), #b8860b); color: #000; transition: 0.3s;
        }
        button:disabled { background: #475569; color: #94a3b8; cursor: not-allowed; }
        .btn-secondary { background: transparent; color: var(--gold); border: 1px solid var(--gold); margin-top: 5px; }

        input, textarea {
            width: 95%; padding: 12px; margin: 8px 0; border-radius: 10px;
            border: 1px solid #334155; background: #0f172a; color: white; text-align: center; font-family: 'Cairo';
        }
        
        .leaderboard-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; border-radius: 12px; background: rgba(255,255,255,0.03); 
            margin-bottom: 8px; font-size: 0.95rem;
        }
        .rank-1 { border: 1px solid var(--gold); background: rgba(242, 169, 0, 0.15); }

        .admin-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px; border-bottom: 1px solid #334155; font-size: 0.75rem; 
        }
        .btn-small { width: auto; padding: 5px 10px; font-size: 0.7rem; margin: 2px; color: white; }
        .btn-red { background: var(--red); }
        .btn-blue { background: var(--blue); }
        .btn-orange { background: #f59e0b; }
        
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px; }
        .toast { padding: 15px 20px; border-radius: 12px; margin-bottom: 10px; color: white; font-weight: 600; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #countdown { font-family: monospace; font-size: 1.2rem; color: var(--gold); margin: 15px 0; font-weight: 800; }
        
        .admin-scroll-box { max-height: 250px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 10px; margin: 10px 0; padding: 5px; }
    </style>
</head>
<body>

    <audio id="login-sound" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>
    <audio id="adhan-sound" src="https://www.islamcan.com/common/adhan/makkah.mp3"></audio>

    <div id="toast-container"></div>

    <div id="explanation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-status"></h2>
            <div class="exp-box" id="modal-text"></div>
            <button onclick="location.reload()">Ø§Ø³ØªÙ…Ø±Ø§Ø± âœ¨</button>
        </div>
    </div>

    <div id="login-page" class="page active">
        <div class="card">
            <h1>ğŸŒ™</h1>
            <h2>Ø±Ù…Ø¶Ø§Ù† Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ 1447</h2>
            <div id="countdown">â³ Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª...</div>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="handleSignUp()" class="btn-secondary">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ âœ¨</button>
        </div>
    </div>

    <div id="main-page" class="page">
        <div class="dhikr-bar" id="dhikr-text">Ø£Ù„Ø§ Ø¨Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ ØªØ·Ù…Ø¦Ù† Ø§Ù„Ù‚Ù„ÙˆØ¨</div>
        <div class="prayer-bar" id="prayer-info">ğŸ“ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ | Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª...</div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="user-display" style="color: var(--gold); font-weight: 800;"></span>
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <b id="user-score">0</b></span>
            </div>
        </div>

        <div id="quiz-area" class="card">
            <h3 style="color: var(--gold);">â­ Ø³Ø¤Ø§Ù„ Ø§Ù„ÙŠÙˆÙ…</h3>
            <div id="quiz-timer">60</div> 
            <div id="q-text">Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø§Ù„Ø³Ø§Ø¹Ø© 8:30 Ù…Ø³Ø§Ø¡Ù‹...</div>
            <div id="options-box" style="margin-top: 10px;"></div>
        </div>

        <div class="card">
            <h3 style="color: var(--gold);">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù (Ù…Ø¨Ø§Ø´Ø± âš¡)</h3>
            <div id="leaderboard-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div id="admin-area" style="display:none;" class="card">
            <h3 style="color:var(--gold)">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            
            <div style="text-align: right;">
                <h4>ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h4>
                <input type="number" id="adm-day" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ…">
                <textarea id="adm-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„"></textarea>
                <input type="text" id="adm-opts" placeholder="Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ø§ÙØµÙ„ Ø¨Ù€ ,)">
                <input type="text" id="adm-correct" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©">
                <textarea id="adm-explanation" placeholder="Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ"></textarea>
                <button onclick="quickAdd()" style="background: var(--success); color: white;">Ø­ÙØ¸ / ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„ âœ…</button>
                
                <h5 style="color: var(--silver);">ğŸ” Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</h5>
                <div id="questions-admin-list" class="admin-scroll-box"></div>
            </div>

            <hr style="opacity: 0.1; margin: 20px 0;">

            <div style="text-align: right;">
                <h4>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</h4>
                <div id="users-admin-list" class="admin-scroll-box"></div>
                <button onclick="resetAllScores()" class="btn-orange" style="margin-top: 10px; color:white;">ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· âš ï¸</button>
            </div>
        </div>
        
        <button onclick="logout()" style="background:none; color:var(--red); border:1px solid var(--red); width: auto; font-size: 0.8rem;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, updatePassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, increment, collection, onSnapshot, query, orderBy, limit, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCKNwu6R3wjeHvWOrpiWkx5fnk0luEX_z4",
            authDomain: "ramadan-d4c32.firebaseapp.com",
            projectId: "ramadan-d4c32",
            storageBucket: "ramadan-d4c32.firebasestorage.app",
            messagingSenderId: "226219397241",
            appId: "1:226219397241:web:c9841a5806ea4402fe04a8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = "m@m.com";
        const RAMADAN_START = new Date("Feb 18, 2026 20:30:00").getTime();

        let quizInterval; 

        // 1. ÙˆØ¸ÙŠÙØ© Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯)
        async function fetchNextPrayer() {
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=Port%20Said&country=Egypt&method=5`);
                const json = await res.json();
                const timings = json.data.timings;
                const now = new Date();
                const currentMinutes = now.getHours() * 60 + now.getMinutes();

                const prayers = [
                    { name: "Ø§Ù„ÙØ¬Ø±", time: timings.Fajr },
                    { name: "Ø§Ù„Ø¸Ù‡Ø±", time: timings.Dhuhr },
                    { name: "Ø§Ù„Ø¹ØµØ±", time: timings.Asr },
                    { name: "Ø§Ù„Ù…ØºØ±Ø¨", time: timings.Maghrib },
                    { name: "Ø§Ù„Ø¹Ø´Ø§Ø¡", time: timings.Isha }
                ];

                let nextPrayer = null;
                for (let p of prayers) {
                    const [h, m] = p.time.split(':').map(Number);
                    const pMinutes = h * 60 + m;
                    
                    if (h === now.getHours() && m === now.getMinutes()) {
                        const adhan = document.getElementById('adhan-sound');
                        if (adhan.paused) { adhan.play().catch(()=>{}); showToast(`Ø­Ø§Ù† Ù…ÙˆØ¹Ø¯ Ø£Ø°Ø§Ù† ${p.name}`, "success"); }
                    }
                    if (pMinutes > currentMinutes && !nextPrayer) nextPrayer = p;
                }
                if (!nextPrayer) nextPrayer = prayers[0];
                document.getElementById('prayer-info').innerHTML = `ğŸ“ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ | Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: <b style="color:var(--gold)">${nextPrayer.name} (${nextPrayer.time})</b>`;
            } catch (e) { console.error(e); }
        }
        setInterval(fetchNextPrayer, 60000);

        // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
        const dhikrs = ["Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡", "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡", "Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±", "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡"];
        setInterval(() => {
            const el = document.getElementById('dhikr-text');
            if(el) el.innerText = `âœ¨ ${dhikrs[Math.floor(Math.random() * dhikrs.length)]} âœ¨`;
        }, 10000);

        setInterval(() => {
            const now = new Date().getTime();
            const diff = RAMADAN_START - now;
            if (diff > 0) {
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                document.getElementById('countdown').innerText = `Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø±Ù…Ø¶Ø§Ù†: ${d}ÙŠ ${h}Ø³ ${m}Ø¯ ${s}Ø«`;
            } else { document.getElementById('countdown').innerText = "Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…! ğŸŒ™"; }
        }, 1000);

        // 3. Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©)
        window.loadAdminQuestions = () => {
            onSnapshot(collection(db, "questions"), (snap) => {
                const list = document.getElementById('questions-admin-list');
                list.innerHTML = '';
                snap.docs.forEach(d => {
                    const div = document.createElement('div');
                    div.className = 'admin-item';
                    div.innerHTML = `<span>ÙŠÙˆÙ… ${d.id.split('_')[1]}: ${d.data().text.substring(0,15)}..</span>
                    <div><button class="btn-small btn-blue" onclick="editQuestion('${d.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn-small btn-red" onclick="deleteQuestion('${d.id}')">Ø­Ø°Ù</button></div>`;
                    list.appendChild(div);
                });
            });
        };

        window.quickAdd = async () => {
            const d = document.getElementById('adm-day').value;
            if(!d) return showToast("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ…", "error");
            await setDoc(doc(db, "questions", `day_${d}`), {
                text: document.getElementById('adm-text').value,
                options: document.getElementById('adm-opts').value.split(','),
                correct: document.getElementById('adm-correct').value.trim(),
                explanation: document.getElementById('adm-explanation').value
            });
            showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…", "success");
        };

        window.editQuestion = async (id) => {
            const q = (await getDoc(doc(db, "questions", id))).data();
            document.getElementById('adm-day').value = id.split('_')[1];
            document.getElementById('adm-text').value = q.text;
            document.getElementById('adm-opts').value = q.options.join(',');
            document.getElementById('adm-correct').value = q.correct;
            document.getElementById('adm-explanation').value = q.explanation;
            showToast("ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        };

        window.deleteQuestion = async (id) => { if(confirm("Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ")) await deleteDoc(doc(db, "questions", id)); };

        // 4. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ 123456)
        window.loadAdminUsers = () => {
            onSnapshot(collection(db, "users"), (snap) => {
                const list = document.getElementById('users-admin-list');
                list.innerHTML = '';
                snap.docs.forEach(d => {
                    if(d.data().email === ADMIN_EMAIL) return;
                    const div = document.createElement('div');
                    div.className = 'admin-item';
                    div.innerHTML = `<span>${d.data().email} (${d.data().score})</span>
                    <div><button class="btn-small btn-orange" onclick="resetUserPassword('${d.data().email}')">ğŸ Ø§Ø³ØªØ¹Ø§Ø¯Ø© 123456</button>
                    <button class="btn-small btn-red" onclick="deleteUser('${d.id}')">Ø­Ø°Ù</button></div>`;
                    list.appendChild(div);
                });
            });
        };

        window.resetUserPassword = async (userEmail) => {
            showToast("Ù…ÙŠØ²Ø© Ø§Ù„Ø£Ø¯Ù…Ù†: ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØºÙŠÙŠØ±Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Admin SDK", "info");
            // ØªÙ†ÙˆÙŠÙ‡: ÙÙŠ Ø§Ù„Ù€ Web SDK Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø³Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©ØŒ 
            // Ù„ÙƒÙ†Ù†Ø§ Ø³Ù†Ø¨Ø±Ù…Ø¬ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø³Ø±Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„.
            await updateDoc(doc(db, "users_meta", "requests"), { [userEmail]: "reset_to_123456" });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ù€ " + userEmail);
        };

        window.resetAllScores = async () => {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ")) {
                const snap = await getDocs(collection(db, "users"));
                snap.forEach(async (u) => await updateDoc(doc(db, "users", u.id), { score: 0, lastSolved: 0 }));
                showToast("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬");
            }
        };

        // 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        async function setupQuiz(solvedDay) {
            const now = new Date().getTime();
            if (now < RAMADAN_START) return;
            const rDay = Math.floor((now - RAMADAN_START) / 86400000) + 1;
            const qSnap = await getDoc(doc(db, "questions", `day_${rDay}`));
            
            if(qSnap.exists() && solvedDay !== rDay) {
                const q = qSnap.data();
                document.getElementById('q-text').innerText = q.text;
                const timerEl = document.getElementById('quiz-timer');
                timerEl.style.display = 'block';
                let timeLeft = 60;
                if(quizInterval) clearInterval(quizInterval);
                quizInterval = setInterval(async () => {
                    timeLeft--;
                    timerEl.innerText = timeLeft;
                    if(timeLeft <= 0) {
                        clearInterval(quizInterval);
                        await updateDoc(doc(db, "users", auth.currentUser.uid), {lastSolved: rDay});
                        showResultModal(false, "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!");
                    }
                }, 1000);

                const box = document.getElementById('options-box');
                box.innerHTML = '';
                q.options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.innerText = opt;
                    btn.onclick = async () => {
                        clearInterval(quizInterval);
                        const isCorrect = opt.trim() === q.correct.trim();
                        await updateDoc(doc(db, "users", auth.currentUser.uid), {lastSolved: rDay, score: increment(isCorrect ? 10 : 0)});
                        showResultModal(isCorrect, q.explanation);
                    };
                    box.appendChild(btn);
                });
            } else if (solvedDay === rDay) {
                document.getElementById('q-text').innerText = "ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ÙŠÙˆÙ… âœ¨";
            }
        }

        // 6. Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ØªØ´ØºÙŠÙ„
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('login-page').classList.remove('active');
                document.getElementById('main-page').classList.add('active');
                document.getElementById('user-display').innerText = user.email.split('@')[0];
                
                onSnapshot(doc(db, "users", user.uid), (snap) => {
                    if(snap.exists()) {
                        document.getElementById('user-score').innerText = snap.data().score;
                        setupQuiz(snap.data().lastSolved);
                    }
                });

                if(user.email === ADMIN_EMAIL) {
                    document.getElementById('admin-area').style.display = 'block';
                    loadAdminUsers(); loadAdminQuestions();
                }
                fetchNextPrayer(); initRealtimeLeaderboard();
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        function showToast(m, type="info") {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = 'toast';
            t.style.background = type === 'success' ? 'var(--success)' : (type === 'error' ? 'var(--red)' : 'var(--blue)');
            t.innerText = m;
            c.appendChild(t);
            setTimeout(() => t.remove(), 3500);
        }

        function initRealtimeLeaderboard() {
            onSnapshot(query(collection(db, "users"), limit(10)), (snap) => {
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = '';
                let users = [];
                snap.forEach(d => { if(d.data().email !== ADMIN_EMAIL) users.push(d.data()); });
                users.sort((a,b) => b.score - a.score).forEach((u, i) => {
                    const item = document.createElement('div');
                    item.className = `leaderboard-item ${i===0?'rank-1':''}`;
                    item.innerHTML = `<span>${i+1}. ${u.email.split('@')[0]}</span><b>${u.score}</b>`;
                    list.appendChild(item);
                });
            });
        }

        window.handleLogin = () => signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value).catch(()=>showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª","error"));
        window.handleSignUp = async () => {
            const e = document.getElementById('email').value, p = document.getElementById('password').value;
            try {
                const res = await createUserWithEmailAndPassword(auth, e, p);
                await setDoc(doc(db, "users", res.user.uid), {email: e, score: 0, lastSolved: 0});
            } catch { showToast("ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„","error"); }
        };
        window.logout = () => signOut(auth).then(()=>location.reload());
        function showResultModal(isCorrect, exp) {
            document.getElementById('explanation-modal').style.display = 'flex';
            document.getElementById('modal-status').innerText = isCorrect ? "ØµØ­ÙŠØ­! ğŸ‰" : "Ø®Ø·Ø£ ğŸŒ™";
            document.getElementById('modal-text').innerText = exp;
        }
    </script>
</body>
</html>
